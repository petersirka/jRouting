!function(c){var h={},v='NAV.',d={cache:{},version:5.6,errors:[],global:{},hashtags:!1,middlewares:{},model:null,params:[],query:{},repository:{},routes:[],url:'',count:0},g={$prev:[],$next:[],isReady:!1,LIMIT_HISTORY:100,LIMIT_HISTORY_ERROR:100};d.history=g.$prev;var l=location;function r(){$(document).ready(function(){d.hashtags?d.url=l.hash||h.path(h.prepareUrl(l.pathname)):d.url=h.path(h.prepareUrl(l.pathname)),setTimeout(function(){g.isReady=!0,d.location(d.url)},5),$(c).on('hashchange',function(){g.isReady&&d.hashtags&&d.location(h.path(l.hash))}).on('popstate',function(){if(g.isReady&&!d.hashtags){var r=h.path(l.pathname);d.url!==r&&d.location(r)}})})}c.NAVIGATION||(c.NAVIGATION=d),c.NAV||(c.NAV=d),c.jR||(c.jR=d),d.remove=function(r){r=r.env(!0).ROOT(!0);for(var t=[],n=0,e=d.routes.length;n<e;n++)d.routes[n].id!==r&&t.push(d.routes[n]);return d.routes=t,d},d.on=function(r,t){return ON(r,t),d},d.emit=function(){EMIT.apply(c,arguments)},d.autosave=function(){d.$save=1},d.save=function(){try{localStorage.setItem(MAIN.$localstorage+'.nav',STRINGIFY({prev:g.$prev,next:g.$next,ts:new Date}))}catch(r){}},d.load=function(){try{var r=PARSE(localStorage.getItem(MAIN.$localstorage+'.nav')||'null');r&&(r.prev instanceof Array&&(g.$prev=d.history=r.prev),r.next instanceof Array&&(g.$next=r.next),d.$pop=!0)}catch(r){}},d.route=function(r,t,n,e){if(t instanceof Array){var a=n;n=t,t=a}'function'==typeof n&&(a=e,e=n,n=a);var i=(r=r.env(!0).ROOT(!0)).jRcount('/')+(-1===r.indexOf('*')?0:10),o=d._route(r.trim()),u=[];'string'==typeof n&&(n=n.split(','));var s=[],l=[],p={};if(n instanceof Array&&n.forEach(function(r){'object'==typeof r?p=r:'@'===r.substring(0,1)?l.push(r.substring(1)):s.push(r)}),-1!==r.indexOf('{')){i-=100;for(var f=0;f<o.length;f++)'{'===o[f].substring(0,1)&&u.push(f);i-=u.length}return d.remove(r),d.routes.push({id:r,url:o,fn:t,priority:i,params:u,middleware:s.length?s:null,init:e,count:0,pending:!1,options:p,roles:l}),d.routes.sort(function(r,t){return r.priority>t.priority?-1:r.priority<t.priority?1:0}),d.is404&&r===d.url&&c.REDIRECT(r+(d.queryraw?'?'+d.queryraw:'')),d.emit('route',r),d},c.MIDDLEWARE=d.middleware=function(r,t){return r instanceof Array?r.wait(function(r,t){var n=d.middlewares[r];n?n(t):t()},t):d.middlewares[r]=t,d},d.refresh=function(){return d.location(d.url,!0)},d.reload=function(){return d.refresh()},d._route=function(r){47===r.charCodeAt(0)&&(r=r.substring(1)),47===r.charCodeAt(r.length-1)&&(r=r.substring(0,r.length-1));var t=r.split('/');return 1!==t.length||t[0]||(t[0]='/'),t},d._route_param=function(r,t){var n=[];if(!t||!r)return n;var e=t.params.length;if(e)for(var a=0;a<e;a++){var i=r[t.params[a]];n.push('/'===i?'':i)}return n},d._route_compare=function(r,t){var n=r.length,e=1===n&&'/'===r[0];if(t.length!==n)return!1;for(var a=0;a<n;a++){var i=t[a];if(!i)return!1;if(e||123!==i.charCodeAt(0)){if('*'===i)return!0;if(r[a]!==i)return!1}}return!0},d.location=function(r,t){if(g.isReady){var n=r.indexOf('?');-1!==n&&(r=r.substring(0,n)),r=h.prepareUrl(r),r=h.path(r);var e=d._route(r),a=[],i=!0,o=[];o.push.apply(o,e);for(var u=0,s=e.length;u<s;u++)e[u]=e[u].toLowerCase();!t&&d.url.length&&d.prev()!==d.url&&(d.$pop?d.$pop=!1:(g.$prev.push(d.url),g.$prev.length>d.LIMIT_HISTORY&&g.$prev.shift(),g.$next.length>d.LIMIT_HISTORY&&g.$next.shift(),d.$save&&d.save()));var l=v+'isback';d.isback!==g.$prev.length&&M.paths[l]&&SET(l,g.$prev.length),l=v+'isforward',d.isforward!==g.$next.length&&M.paths[l]&&SET(l,g.$next.length);for(s=d.routes.length,u=0;u<s;u++){var p=d.routes[u];if(d._route_compare(e,p.url)&&(-1===p.url.indexOf('*')&&(i=!1),!(p.once&&0<p.count))){p.count++,a.push(p);break}}d.url.length&&(d.cache[d.url]=d.repository);var f=d.url;d.url=r,l=v+'url',d.url!==f&&M.paths[l]&&UPD(l),d.repository=d.cache[r],l=v+'repository',M.paths[l]&&UPD(l),d.repository||(d.repository={}),d._params(),d.params=d._route_param(o,p),l=v+'params',M.paths[l]&&UPD(l),d.is404=!1,d.emit('location',r),s=a.length;for(u=0;u<s;u++){if(!(p=a[u]).pending)if(p.middleware&&p.middleware.length)!function(t){for(var r=t.middleware.length,e=[],n=0;n<r;n++){var a=d.middlewares[t.middleware[n]];a&&function(t,n){e.push(function(r){n.call(d,r,t.options,t.roles,t)})}(t,a)}if(!t.init)return t.pending=!0,e.jRmiddleware(function(r){r||t.fn.apply(d,d.params),t.pending=!1},t);t.pending=!0,t.init(function(){e.jRmiddleware(function(r){r||t.fn.apply(d,d.params),t.pending=!1},t)}),t.init=null}(p);else{if(!p.init){p.fn.apply(d,d.params);continue}p.pending=!0,function(r){r.init(function(){r.fn.apply(d,d.params),r.pending=!1})}(p),p.init=null}}i?(d.is404=!0,d.status(404)):d.is404=!1}},d.prev=function(){return g.$prev[g.$prev.length-1]},d.next=function(){return g.$next[g.$next.length-1]},d.back=function(r){var t=g.$prev.pop()||'/';return d.url&&d.next()!==d.url&&g.$next.push(d.url),d.url='',c.REDIRECT(t,r),d.$save&&d.save(),d},d.forward=function(r){var t=g.$next.pop()||'/';return d.url&&d.prev()!==d.url&&g.$prev.push(d.url),d.url='',c.REDIRECT(t,r),d.$save&&d.save(),d},d.status=function(r,t){return EMIT(r,t),d},c.REDIRECT=NAV.redirect=function(r,t){var n=(r=(r=r||d.url).env(!0).ROOT(!0)).charCodeAt(0),e=l;35===n?(d.model=t||null,e.hash=r,d.location(r,!1)):history.pushState?(history.pushState(null,null,r),d.model=t||null,d.location(e.pathname+e.search,!1)):e.href=r},d._params=function(){var r={},t=l.href.indexOf('?');d.queryraw=-1===t?'':l.href.substring(t+1);for(var n=d.queryraw.split('&'),e=0;e<n.length;e++){var a=n[e].split('=');if(2===a.length){var i=decodeURIComponent(a[0]),o=decodeURIComponent(a[1]),u=r[i]instanceof Array;r[i]&&!u&&(r[i]=[r[i]]),u?r[i].push(o):r[i]=o}}d.query=r;var s=v+'query';return M.paths[s]&&UPD(s),d},d.path=h.path=function(r,t){if('#'===r.substring(0,1))return r;t=t||'/';var n=r.indexOf('?'),e='';-1!==n&&(e=r.substring(n),r=r.substring(0,n));var a=r.length;return r.substring(a-1,a)!==t&&(r+=t),r+e},h.prepareUrl=function(r){if('#'===r.substring(0,1))return r;var t=r.indexOf('#');return-1!==t?r.substring(0,t):r},Array.prototype.jRmiddleware=function(t,n){var e=this,r=e.shift();return void 0===r?t&&t():r(function(r){r instanceof Error||!1===r?t&&t(!1===r||r):setTimeout(function(){e.jRmiddleware(t,n)},1)},n.options,n.roles),e},String.prototype.jRcount=function(r){for(var t=0,n=0;0<(t=this.indexOf(r,t+r.length))&&n++,0<t;);return n},d.clientside=function(r){return $(document).on('click',r,function(r){r.preventDefault();var t=$(this),n=t.attr('href')||t.attrd('href')||t.attrd('url');'javascript:void(0)'!==n&&'#'!==n&&c.REDIRECT(n)}),d},c.jQuery&&c.MAIN&&c.MAIN.loaded?r():d.init=setInterval(function(){c.jQuery&&c.MAIN&&c.MAIN.loaded&&(clearInterval(d.init),r())},100),d._params(),c.ROUTE=function(r,t,n,e){return d.route(r,t,n,e)}}(window);