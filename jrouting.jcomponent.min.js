!function(){var c={},h='NAV.',v={cache:{},version:5.6,errors:[],global:{},hashtags:!1,middlewares:{},model:null,params:[],query:{},repository:{},routes:[],url:'',count:0},d={$prev:[],$next:[],isReady:!1,LIMIT_HISTORY:100,LIMIT_HISTORY_ERROR:100};v.history=d.$prev;var l=location;function r(){v._params(),$(document).ready(function(){v.hashtags?v.url=l.hash||c.path(c.prepareUrl(l.pathname)):v.url=c.path(c.prepareUrl(l.pathname)),setTimeout(function(){d.isReady=!0,v.location(v.url)},5),$(W).on('hashchange',function(){d.isReady&&v.hashtags&&v.location(c.path(l.hash))}).on('popstate',function(){if(d.isReady&&!v.hashtags){var r=c.path(l.pathname);v.url!==r&&v.location(r)}})})}W.NAVIGATION||(W.NAVIGATION=v),W.NAV||(W.NAV=v),W.jR||(W.jR=v),v.remove=function(r){r=r.env(!0).ROOT(!0);for(var t=[],e=0,n=v.routes.length;e<n;e++)v.routes[e].id!==r&&t.push(v.routes[e]);return v.routes=t,v},v.on=function(r,t){return ON(r,t),v},v.emit=function(){EMIT.apply(W,arguments)},v.autosave=function(){v.$save=1},v.save=function(){try{localStorage.setItem(MAIN.$localstorage+'.nav',STRINGIFY({prev:d.$prev,next:d.$next,ts:new Date}))}catch(r){}},v.load=function(){try{var r=PARSE(localStorage.getItem(MAIN.$localstorage+'.nav')||'null');r&&(r.prev instanceof Array&&(d.$prev=v.history=r.prev),r.next instanceof Array&&(d.$next=r.next),v.$pop=!0)}catch(r){}},v.route=function(r,t,e,n){if(t instanceof Array){var a=e;e=t,t=a}'function'==typeof e&&(a=n,n=e,e=a);var i=(r=r.env(!0).ROOT(!0)).jRcount('/')+(-1===r.indexOf('*')?0:10),o=v._route(r.trim()),u=[];'string'==typeof e&&(e=e.split(','));var s=[],l=[],p={};if(e instanceof Array&&e.forEach(function(r){'object'==typeof r?p=r:'@'===r.substring(0,1)?l.push(r.substring(1)):s.push(r)}),-1!==r.indexOf('{')){i-=100;for(var f=0;f<o.length;f++)'{'===o[f].substring(0,1)&&u.push(f);i-=u.length}return v.remove(r),v.routes.push({id:r,url:o,fn:t,priority:i,params:u,middleware:s.length?s:null,init:n,count:0,pending:!1,options:p,roles:l}),v.routes.sort(function(r,t){return r.priority>t.priority?-1:r.priority<t.priority?1:0}),v.is404&&r===v.url&&W.REDIRECT(r+(v.queryraw?'?'+v.queryraw:'')),v.emit('route',r),v},W.MIDDLEWARE=v.middleware=function(r,t){return r instanceof Array?r.wait(function(r,t){var e=v.middlewares[r];e?e(t):t()},t):v.middlewares[r]=t,v},v.refresh=function(){return v.location(v.url,!0)},v.reload=function(){return v.refresh()},v._route=function(r){47===r.charCodeAt(0)&&(r=r.substring(1)),47===r.charCodeAt(r.length-1)&&(r=r.substring(0,r.length-1));var t=r.split('/');return 1!==t.length||t[0]||(t[0]='/'),t},v._route_param=function(r,t){var e=[];if(!t||!r)return e;var n=t.params.length;if(n)for(var a=0;a<n;a++){var i=r[t.params[a]];e.push('/'===i?'':i)}return e},v._route_compare=function(r,t){var e=r.length,n=1===e&&'/'===r[0];if(t.length!==e)return!1;for(var a=0;a<e;a++){var i=t[a];if(!i)return!1;if(n||123!==i.charCodeAt(0)){if('*'===i)return!0;if(r[a]!==i)return!1}}return!0},v.location=function(r,t){if(d.isReady){var e=r.indexOf('?');-1!==e&&(r=r.substring(0,e)),r=c.prepareUrl(r),r=c.path(r);var n=v._route(r),a=[],i=!0,o=[];o.push.apply(o,n);for(var u=0,s=n.length;u<s;u++)n[u]=n[u].toLowerCase();!t&&v.url.length&&v.prev()!==v.url&&(v.$pop?v.$pop=!1:(d.$prev.push(v.url),d.$prev.length>v.LIMIT_HISTORY&&d.$prev.shift(),d.$next.length>v.LIMIT_HISTORY&&d.$next.shift(),v.$save&&v.save()));var l=h+'isback';v.isback!==d.$prev.length&&M.paths[l]&&SET(l,d.$prev.length),l=h+'isforward',v.isforward!==d.$next.length&&M.paths[l]&&SET(l,d.$next.length);for(s=v.routes.length,u=0;u<s;u++){var p=v.routes[u];if(v._route_compare(n,p.url)&&(-1===p.url.indexOf('*')&&(i=!1),!(p.once&&0<p.count))){p.count++,a.push(p);break}}v.url.length&&(v.cache[v.url]=v.repository);var f=v.url;v.url=r,l=h+'url',v.url!==f&&M.paths[l]&&UPD(l),v.repository=v.cache[r],l=h+'repository',M.paths[l]&&UPD(l),v.repository||(v.repository={}),v._params(),v.params=v._route_param(o,p),l=h+'params',M.paths[l]&&UPD(l),v.is404=!1,v.emit('location',r),s=a.length;for(u=0;u<s;u++){if(!(p=a[u]).pending)if(p.middleware&&p.middleware.length)!function(t){for(var r=t.middleware.length,n=[],e=0;e<r;e++){var a=v.middlewares[t.middleware[e]];a&&function(t,e){n.push(function(r){e.call(v,r,t.options,t.roles,t)})}(t,a)}if(!t.init)return t.pending=!0,n.jRmiddleware(function(r){r||t.fn.apply(v,v.params),t.pending=!1},t);t.pending=!0,t.init(function(){n.jRmiddleware(function(r){r||t.fn.apply(v,v.params),t.pending=!1},t)}),t.init=null}(p);else{if(!p.init){p.fn.apply(v,v.params);continue}p.pending=!0,function(r){r.init(function(){r.fn.apply(v,v.params),r.pending=!1})}(p),p.init=null}}i?(v.is404=!0,v.status(404)):v.is404=!1}},v.prev=function(){return d.$prev[d.$prev.length-1]},v.next=function(){return d.$next[d.$next.length-1]},v.back=function(r){var t=d.$prev.pop()||'/';return v.url&&v.next()!==v.url&&d.$next.push(v.url),v.url='',W.REDIRECT(t,r),v.$save&&v.save(),v},v.forward=function(r){var t=d.$next.pop()||'/';return v.url&&v.prev()!==v.url&&d.$prev.push(v.url),v.url='',W.REDIRECT(t,r),v.$save&&v.save(),v},v.status=function(r,t){return EMIT(r,t),v},W.REDIRECT=NAV.redirect=function(r,t){var e=(r=(r=r||v.url).env(!0).ROOT(!0)).charCodeAt(0),n=l;35===e?(v.model=t||null,n.hash=r,v.location(r,!1)):history.pushState?(history.pushState(null,null,r),v.model=t||null,v.location(n.pathname+n.search,!1)):n.href=r},v._params=function(){var r={},t=l.href.indexOf('?');v.queryraw=-1===t?'':l.href.substring(t+1);for(var e=v.queryraw.split('&'),n=0;n<e.length;n++){var a=e[n].split('=');if(2===a.length){var i=decodeURIComponent(a[0]),o=decodeURIComponent(a[1]),u=r[i]instanceof Array;r[i]&&!u&&(r[i]=[r[i]]),u?r[i].push(o):r[i]=o}}v.query=r;var s=h+'query';return M.paths[s]&&UPD(s),v},v.path=c.path=function(r,t){if('#'===r.substring(0,1))return r;t=t||'/';var e=r.indexOf('?'),n='';-1!==e&&(n=r.substring(e),r=r.substring(0,e));var a=r.length;return r.substring(a-1,a)!==t&&(r+=t),r+n},c.prepareUrl=function(r){if('#'===r.substring(0,1))return r;var t=r.indexOf('#');return-1!==t?r.substring(0,t):r},Array.prototype.jRmiddleware=function(t,e){var n=this,r=n.shift();return void 0===r?t&&t():r(function(r){r instanceof Error||!1===r?t&&t(!1===r||r):setTimeout(function(){n.jRmiddleware(t,e)},1)},e.options,e.roles),n},String.prototype.jRcount=function(r){for(var t=0,e=0;0<(t=this.indexOf(r,t+r.length))&&e++,0<t;);return e},v.clientside=function(r){return $(document).on('click',r,function(r){r.preventDefault();var t=$(this),e=t.attr('href')||t.attrd('href')||t.attrd('url');'javascript:void(0)'!==e&&'#'!==e&&W.REDIRECT(e)}),v},W.jQuery&&W.MAIN&&W.MAIN.loaded?r():v.init=setInterval(function(){W.jQuery&&W.MAIN&&W.MAIN.loaded&&(clearInterval(v.init),r())},100),W.ROUTE=function(r,t,e,n){return v.route(r,t,e,n)}}();